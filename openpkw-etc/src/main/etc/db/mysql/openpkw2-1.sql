-- MySQL Script generated by MySQL Workbench
-- 11/03/15 12:38:41
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema openpkw2
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `openpkw2` DEFAULT CHARACTER SET utf8 ;

-- -----------------------------------------------------
-- Table `openpkw2`.`DISTRICT_COMMITTEE_ADDRESS`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `openpkw2`.`DISTRICT_COMMITTEE_ADDRESS` (
  `DISTRICT_COMMITTEE_ADDRESS_ID` INT NOT NULL AUTO_INCREMENT,
  `NAME` VARCHAR(300) NULL DEFAULT NULL,
  `STREET` VARCHAR(45) NOT NULL,
  `BUILDING_NUMBER` VARCHAR(10) NOT NULL,
  `ROOM_NUMBER` VARCHAR(45) NULL DEFAULT NULL,
  `CITY` VARCHAR(45) NOT NULL,
  `POSTAL_CODE` VARCHAR(45) NOT NULL,
  `POST` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`DISTRICT_COMMITTEE_ADDRESS_ID`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `openpkw2`.`DISTRICT_COMMITTEE`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `openpkw2`.`DISTRICT_COMMITTEE` (
  `DISTRICT_COMMITTEE_ID` INT NOT NULL,
  `DISTRICT_COMMITTEE_ADDRESS_ID` INT NOT NULL,
  `NAME` VARCHAR(150) NOT NULL,
  PRIMARY KEY (`DISTRICT_COMMITTEE_ID`),
  UNIQUE INDEX `DISTRICT_COMMITTEE_ID_UNIQUE` (`DISTRICT_COMMITTEE_ID` ASC),
  INDEX `fk_DISTRICT_COMMITTEE_DISTRICT_COMMITTEE_ADDRESS_idx` (`DISTRICT_COMMITTEE_ADDRESS_ID` ASC),
  CONSTRAINT `fk_DISTRICT_COMMITTEE_DISTRICT_COMMITTEE_ADDRESS`
    FOREIGN KEY (`DISTRICT_COMMITTEE_ADDRESS_ID`)
    REFERENCES `openpkw2`.`DISTRICT_COMMITTEE_ADDRESS` (`DISTRICT_COMMITTEE_ADDRESS_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `openpkw2`.`USER_TYPE`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `openpkw2`.`USER_TYPE` (
  `USER_TYPE_ID` INT NOT NULL AUTO_INCREMENT,
  `USER_TYPE` VARCHAR(45) NULL DEFAULT NULL,
  PRIMARY KEY (`USER_TYPE_ID`),
  UNIQUE INDEX `USER_TYPE_ID_UNIQUE` (`USER_TYPE_ID` ASC))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `openpkw2`.`USER`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `openpkw2`.`USER` (
  `USER_ID` INT NOT NULL AUTO_INCREMENT,
  `USER_TYPE_ID` INT NOT NULL,
  `FIRST_NAME` VARCHAR(45) NOT NULL,
  `LAST_NAME` VARCHAR(45) NOT NULL,
  `EMAIL` VARCHAR(45) NULL DEFAULT NULL,
  `PASSWORD` VARCHAR(100) NOT NULL,
  `IS_ACTIVE` TINYINT(1) NOT NULL,
  UNIQUE INDEX `USER_ID_UNIQUE` (`USER_ID` ASC),
  PRIMARY KEY (`USER_ID`),
  UNIQUE INDEX `EMAIL_UNIQUE` (`EMAIL` ASC),
  INDEX `fk_USER_USER_TYPE1_idx` (`USER_TYPE_ID` ASC),
  CONSTRAINT `fk_USER_USER_TYPE1`
    FOREIGN KEY (`USER_TYPE_ID`)
    REFERENCES `openpkw2`.`USER_TYPE` (`USER_TYPE_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `openpkw2`.`USER_SESSION`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `openpkw2`.`USER_SESSION` (
  `USER_SESSION_ID` INT NOT NULL,
  `USER_ID` INT NOT NULL,
  `TOKEN` VARCHAR(30) NOT NULL,
  `CREATION_DATE` TIMESTAMP NOT NULL,
  `VALID_UNTIL` TIMESTAMP NULL,
  PRIMARY KEY (`USER_SESSION_ID`),
  UNIQUE INDEX `USER_SESSION_ID_UNIQUE` (`USER_SESSION_ID` ASC),
  INDEX `fk_USER_SESSION_USER1_idx` (`USER_ID` ASC),
  CONSTRAINT `fk_USER_SESSION_USER1`
    FOREIGN KEY (`USER_ID`)
    REFERENCES `openpkw2`.`USER` (`USER_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `openpkw2`.`ELECTION_COMMITTEE`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `openpkw2`.`ELECTION_COMMITTEE` (
  `ELECTION_COMMITTEE_ID` INT NOT NULL,
  `NAME` VARCHAR(100) NOT NULL,
  PRIMARY KEY (`ELECTION_COMMITTEE_ID`),
  UNIQUE INDEX `ELECTION_COMMITTEE_ID_UNIQUE` (`ELECTION_COMMITTEE_ID` ASC))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `openpkw2`.`ELECTION_COMMITTEE_DISTRICT`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `openpkw2`.`ELECTION_COMMITTEE_DISTRICT` (
  `ELECTION_COMMITTEE_DISTRICT_ID` INT NOT NULL,
  `ELECTION_COMMITTEE_ID` INT NOT NULL,
  `DISTRICT_COMMITTEE_ID` INT NOT NULL,
  `LIST_NUMBER` INT NULL,
  PRIMARY KEY (`ELECTION_COMMITTEE_DISTRICT_ID`),
  INDEX `fk_ELECTION_COMMITTEE_DISTRICT_CANDIDATE_ELECTION_COMMITTEE_idx` (`ELECTION_COMMITTEE_ID` ASC),
  INDEX `fk_ELECTION_COMMITTEE_DISTRICT_CANDIDATE_DISTRICT_COMMITTEE_idx` (`DISTRICT_COMMITTEE_ID` ASC),
  CONSTRAINT `fk_ELECTION_COMMITTEE_DISTRICT_CANDIDATE_ELECTION_COMMITTEE1`
    FOREIGN KEY (`ELECTION_COMMITTEE_ID`)
    REFERENCES `openpkw2`.`ELECTION_COMMITTEE` (`ELECTION_COMMITTEE_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_ELECTION_COMMITTEE_DISTRICT_CANDIDATE_DISTRICT_COMMITTEE1`
    FOREIGN KEY (`DISTRICT_COMMITTEE_ID`)
    REFERENCES `openpkw2`.`DISTRICT_COMMITTEE` (`DISTRICT_COMMITTEE_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `openpkw2`.`CANDIDATE`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `openpkw2`.`CANDIDATE` (
  `CANDIDATE_ID` INT NOT NULL,
  `NAME` VARCHAR(45) NULL,
  `SURNAME` VARCHAR(45) NULL,
  `POSITION_ON_LIST` INT NULL,
  `IS_ACTIVE` TINYINT(1) NULL,
  `ELECTION_COMMITTEE_DISTRICT_ID` INT NOT NULL,
  PRIMARY KEY (`CANDIDATE_ID`),
  INDEX `fk_CANDIDATE_ELECTION_COMMITTEE_DISTRICT1_idx` (`ELECTION_COMMITTEE_DISTRICT_ID` ASC),
  CONSTRAINT `fk_CANDIDATE_ELECTION_COMMITTEE_DISTRICT1`
    FOREIGN KEY (`ELECTION_COMMITTEE_DISTRICT_ID`)
    REFERENCES `openpkw2`.`ELECTION_COMMITTEE_DISTRICT` (`ELECTION_COMMITTEE_DISTRICT_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `openpkw2`.`PERIPHERAL_COMMITTEE_ADDRESS`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `openpkw2`.`PERIPHERAL_COMMITTEE_ADDRESS` (
  `PERIPHERAL_COMMITTEE_ADDRESS_ID` INT NOT NULL AUTO_INCREMENT,
  `NAME` VARCHAR(300) NULL DEFAULT NULL,
  `STREET` VARCHAR(45) NOT NULL,
  `BUILDING_NUMBER` VARCHAR(10) NOT NULL,
  `ROOM_NUMBER` VARCHAR(45) NULL DEFAULT NULL,
  `CITY` VARCHAR(45) NOT NULL,
  `POSTAL_CODE` VARCHAR(45) NOT NULL,
  `POST` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`PERIPHERAL_COMMITTEE_ADDRESS_ID`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `openpkw2`.`PERIPHERAL_COMMITTEE`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `openpkw2`.`PERIPHERAL_COMMITTEE` (
  `PERIPHERAL_COMMITTEE_ID` INT NOT NULL AUTO_INCREMENT,
  `PERIPHERAL_COMMITTEE_ADDRESS_ID` INT NOT NULL,
  `DISTRICT_COMMITTEE_ID` INT NOT NULL,
  `NAME` VARCHAR(45) NULL DEFAULT NULL,
  `TYPE` VARCHAR(45) NULL DEFAULT NULL,
  `ALLOWED_TO_VOTE` INT NOT NULL,
  `TERRITORIAL_CODE` VARCHAR(45) NOT NULL,
  `PERIPHERAL_CODE` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`PERIPHERAL_COMMITTEE_ID`),
  INDEX `fk_PERIPHERAL_COMMITTEE_PERIPHERAL_COMMITTEE_ADDRESS1_idx` (`PERIPHERAL_COMMITTEE_ADDRESS_ID` ASC),
  INDEX `fk_PERIPHERAL_COMMITTEE_DISTRICT_COMMITTEE1_idx` (`DISTRICT_COMMITTEE_ID` ASC),
  CONSTRAINT `fk_PERIPHERAL_COMMITTEE_PERIPHERAL_COMMITTEE_ADDRESS1`
    FOREIGN KEY (`PERIPHERAL_COMMITTEE_ADDRESS_ID`)
    REFERENCES `openpkw2`.`PERIPHERAL_COMMITTEE_ADDRESS` (`PERIPHERAL_COMMITTEE_ADDRESS_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_PERIPHERAL_COMMITTEE_DISTRICT_COMMITTEE1`
    FOREIGN KEY (`DISTRICT_COMMITTEE_ID`)
    REFERENCES `openpkw2`.`DISTRICT_COMMITTEE` (`DISTRICT_COMMITTEE_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `openpkw2`.`PROTOCOL`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `openpkw2`.`PROTOCOL` (
  `PROTOCOL_ID` INT NOT NULL AUTO_INCREMENT,
  `PERIPHERAL_COMMITTEE_ID` INT NOT NULL,
  `NAME` VARCHAR(45) NOT NULL,
  `CARDS_GIVEN` INT NOT NULL,
  `RECEIVED_DATE` TIMESTAMP NOT NULL,
  PRIMARY KEY (`PROTOCOL_ID`),
  INDEX `fk_PROTOCOL_PERIPHERAL_COMMITTEE1_idx` (`PERIPHERAL_COMMITTEE_ID` ASC),
  CONSTRAINT `fk_PROTOCOL_PERIPHERAL_COMMITTEE1`
    FOREIGN KEY (`PERIPHERAL_COMMITTEE_ID`)
    REFERENCES `openpkw2`.`PERIPHERAL_COMMITTEE` (`PERIPHERAL_COMMITTEE_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `openpkw2`.`VOTE`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `openpkw2`.`VOTE` (
  `VOTE_ID` INT NOT NULL,
  `CANDIDATE_CANDIDATE_ID` INT NOT NULL,
  `PROTOCOL_PROTOCOL_ID` INT NOT NULL,
  `CANDIDATES_VOTES_NUMBER` INT NULL,
  PRIMARY KEY (`VOTE_ID`),
  INDEX `fk_VOTE_CANDIDATE1_idx` (`CANDIDATE_CANDIDATE_ID` ASC),
  INDEX `fk_VOTE_PROTOCOL1_idx` (`PROTOCOL_PROTOCOL_ID` ASC),
  CONSTRAINT `fk_VOTE_CANDIDATE1`
    FOREIGN KEY (`CANDIDATE_CANDIDATE_ID`)
    REFERENCES `openpkw2`.`CANDIDATE` (`CANDIDATE_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_VOTE_PROTOCOL1`
    FOREIGN KEY (`PROTOCOL_PROTOCOL_ID`)
    REFERENCES `openpkw2`.`PROTOCOL` (`PROTOCOL_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `openpkw2`.`ELECTION_COMMITTEE_VOTE`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `openpkw2`.`ELECTION_COMMITTEE_VOTE` (
  `ELECTION_COMMITTEE_VOTE_ID` INT NOT NULL,
  `PROTOCOL_PROTOCOL_ID` INT NOT NULL,
  `ELECTION_COMMITTEE_VOTE_NUMBER` INT NULL,
  `ELECTION_COMMITTEE_DISTRICT_ID` INT NOT NULL,
  PRIMARY KEY (`ELECTION_COMMITTEE_VOTE_ID`),
  INDEX `fk_ELECTION_COMMITTEE_VOTE_PROTOCOL1_idx` (`PROTOCOL_PROTOCOL_ID` ASC),
  INDEX `fk_ELECTION_COMMITTEE_VOTE_ELECTION_COMMITTEE_DISTRICT1_idx` (`ELECTION_COMMITTEE_DISTRICT_ID` ASC),
  CONSTRAINT `fk_ELECTION_COMMITTEE_VOTE_PROTOCOL1`
    FOREIGN KEY (`PROTOCOL_PROTOCOL_ID`)
    REFERENCES `openpkw2`.`PROTOCOL` (`PROTOCOL_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_ELECTION_COMMITTEE_VOTE_ELECTION_COMMITTEE_DISTRICT1`
    FOREIGN KEY (`ELECTION_COMMITTEE_DISTRICT_ID`)
    REFERENCES `openpkw2`.`ELECTION_COMMITTEE_DISTRICT` (`ELECTION_COMMITTEE_DISTRICT_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

USE `openpkw2` ;

SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;